<div class="chatbotscript">
  <style>
    .embeddedServiceHelpButton .helpButton .uiButton {
      background-color: #005290;
      font-family: "Arial", sans-serif;
    }

    .embeddedServiceHelpButton .helpButton .uiButton:focus {
      outline: 1px solid #005290;
    }
  </style>

  <script type='text/javascript'
    src='https://vidaworld--sit.sandbox.my.salesforce.com/lightning/lightning.out.js'></script>

  <script type='text/javascript' src='https://service.force.com/embeddedservice/5.0/esw.min.js'></script>
  <script type='text/javascript'>
    function getCookie(cname) {
      const name = cname + "=";
      const decodedCookie = decodeURIComponent(document.cookie);
      const ca = decodedCookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return "";
    }

    const sessionToken = getCookie("SESSION_TOKEN");
    var registeredUser = Boolean(sessionToken);
    function bootstrapChat() {
      // get user data here 
      if (!registeredUser) {
        var baseCoreURL = 'https://vidaworld--sit.sandbox.my.salesforce.com';
        var communityEndpointURL = 'https://vidaworld--sit.sandbox.my.site.com/partners';
        embedded_svc.bootstrapEmbeddedService(baseCoreURL, communityEndpointURL);
      } else {
        embedded_svc.liveAgentAPI.startChat({
          directToAgentRouting: {
            buttonId: "5730l0000004Cl1"
          },
          extraPrechatFormDetails: [{
            "label": "Pincode",
            "transcriptFields": ["Pincode__c"]
          }, {
            "label": "First Name",
            "transcriptFields": ["First_Name__c"]
          }, {
            "label": "Last Name",
            "transcriptFields": ["Last_Name__c"]
          }, {
            "label": "Mobile",
            "transcriptFields": ["Phone__c"]
          }, {
            "label": "Email",
            "transcriptFields": ["Email1__c"]
          }]
        });
      }
    }

    var initESW = function (gslbBaseURL) {
      embedded_svc.settings.displayHelpButton = false; //Or false
      embedded_svc.settings.language = ''; //For example, enter 'en' or 'en-US'
      embedded_svc.settings.chatbotAvatarImgURL = 'https://stage.vidaworld.com/content/dam/vida/cb/V_logo.png';
      embedded_svc.settings.smallCompanyLogoImgURL = 'https://stage.vidaworld.com/content/dam/vida/cb/V_logo.png';
      embedded_svc.settings.enabledFeatures = ['LiveAgent'];
      embedded_svc.settings.entryFeature = 'LiveAgent';
      embedded_svc.settings.extraPrechatFormDetails = [{
        "label": "Pincode",
        "transcriptFields": ["Pincode__c"]
      }, {
        "label": "First Name",
        "transcriptFields": ["First_Name__c"]
      }, {
        "label": "Last Name",
        "transcriptFields": ["Last_Name__c"]
      }, {
        "label": "Mobile",
        "transcriptFields": ["Phone__c"]
      }, {
        "label": "Email",
        "transcriptFields": ["Email1__c"]
      }];
      embedded_svc.init(
        'https://vidaworld--sit.sandbox.my.salesforce.com',
        'https://vidaworld--sit.sandbox.my.site.com/partners',
        gslbBaseURL,
        '00D0l0000003gYK',
        'HeroVida',
        {
          baseLiveAgentContentURL: 'https://c.la1-c1cs-ukb.salesforceliveagent.com/content',
          deploymentId: '5720l0000004Cfr',
          buttonId: '5730l0000004Cl1',
          baseLiveAgentURL: 'https://d.la1-c1cs-ukb.salesforceliveagent.com/chat',
          eswLiveAgentDevName: 'HeroVida',
          isOfflineSupportEnabled: false
        }
      );
    };

    if (!window.embedded_svc) {
      var s = document.createElement('script');
      s.setAttribute('src', 'https://vidaworld--sit.sandbox.my.salesforce.com/embeddedservice/5.0/esw.min.js');
      s.onload = function () {
        initESW(null);
      };
      document.body.appendChild(s);
    } else {
      initESW('https://service.force.com');
    }
  </script>


</div>

<section class="vida-floating-icon" data-component="floating-icon">
  <div class="vida-floating-icon__container">
    <!-- <div class="vida-floating-icon__section">
      <div class="vida-floating-icon__bubble vida-floating-icon__bubble--booking">
        <a href="test-drive.html" class="cta--anchor" data-link-position="Bottom" role="Link"> <i class="icon-scooter"></i></a>
      </div>
      <div class="vida-floating-icon__pop-up vida-floating-icon__pop-up--booking ">
        <p>Test Ride Now</p>
      </div>
    </div> -->
    <div class="vida-floating-icon__section" onclick="bootstrapChat()">
      <div class="vida-floating-icon__bubble vida-floating-icon__bubble--chat">
        <span data-vida-icon="Chat"> <i class="icon-chat"></i></span>
      </div>
      <div class="vida-floating-icon__pop-up vida-floating-icon__pop-up--chat">
        <p>Chat with Us</p>
      </div>
    </div>
  </div>
</section>